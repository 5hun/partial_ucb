# partial_ucb

- [partial\_ucb](#partial_ucb)
  - [概要](#概要)
  - [問題設定](#問題設定)
  - [アルゴリズム](#アルゴリズム)
  - [実験内容](#実験内容)
  - [使用方法](#使用方法)


## 概要

## 問題設定

以下のような問題を考える。
目的関数$f : X \to \mathbb{R}$が与えられたとする。
定義域$X$は$X = \prod_{i=1}^2 [l_i, u_i]$とする。

$f$はいくつかの関数の集合$f_i: \mathbb{R}^{k_i} \to \mathbb{R}^{l_i}$の合成として表現される。
$F = \{f_1, \dots, f_m\}$とする。
$g_j \in F (j=1,\dots, m)$は$F$のいずれかに関数に対応する。
$g_m$は最終的な$f$の出力を表す。
$O_j(x)$は$x\in X$を入力とした時の$g_j$の出力を表す。
そして、$I_j(x)$は$x$を入力としたときの$g_j$の入力を表す。$I_j(x)$の要素は$x$の一部または$O_k(x) (k \neq j)$の一部を表す
また、$g_j$に対応する$f_i$を$f_{i_j}$とする。

例えば、$f(x) = \sin(x_1) + \cos(x_2)$のような関数を考える。
すると、$f_1(x) = \sin(x)$, $f_2(x) = \cos(x)$, $f_3(x_1, x_2) = x_1 + x_2$であり、
$g_1 = f_1$, $g_2 = f_2$, $g_3 = f_3$とする。
また、$I_1(x) = (x_1), I_2(x) = (x_2), I_3(x) = (O_1(x)_1, O_2(x)_1)$となる。

各$f_i (i=1,\dots, n)$は以下のいずれかに分けられるとする。

- $f_i$の関数値の評価や勾配の計算が低コストで可能である。
- $f_i$はブラックボックス関数であり、高いコストで関数値の評価のみ可能である。勾配は計算できない。

また、ブラックボックス関数であるような$f_i$の集合を$F_B$とする。

このような問題設定の下で、$f$を最適化したい。
$f_i$が評価が高コストなブラックボックス関数であるので、
ブラックボックスな$f_i$の評価回数をできる限り抑えながら最適化を行いたい。

## アルゴリズム

上記の問題に対して以下のようなアルゴリズムを提案する。

1. 初期データの収集
   1. 各$f_i \in F_B$の定義域からランダムに一定個数サンプリングして$f_i$の評価を行う。評価した結果のデータを$D_i = \{(x_k, f_i(x_k))\}_{k=1}^{n_i}$とする。
2. 適応的データ収集
   1. UCBを用いた場合の解を求める。
      1. $f_i \in F_B$に対してデータ$D_i$を用いてガウス過程を当てはめる。そしてUCBを返す関数を$\hat{f}_i$とおく。
      2. $f_i \in F_B$の代わりに$\hat{f}_i$を用いて、$f$の最適化を行う。得られた解を$x^*$とする。
      3. 各$f_{i_j}(I_j(x^\ast))$に対して後述する$r_{j}(x^\ast)$を計算する。
      4. $r_j(x^*)$が最大となるような$f_{i_j}(I_j(x^\ast))$を評価する。評価した結果は$D_{i_j}$に追加する。
3. 解の出力
   1. 各$f_i \in F_B$に対して$D_i$を用いてガウス過程を当てはめる。当てはめた結果の関数を$\bar{f}_i$とする。
   2. $f_i \in F_B$の代わりに$\bar{f}_i$を用いて、$f$の最適化を行う。得られた解を$x^*$とする。
   3. $x^*$を出力する。

## 実験内容

## 使用方法
